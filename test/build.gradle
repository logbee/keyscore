buildscript {
    repositories { mavenCentral() }
    dependencies { classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.3' }
}

apply plugin: 'scala'
apply plugin: 'org.junit.platform.gradle.plugin'
apply from: rootProject.file('dependencies.gradle')

repositories {
    mavenCentral()
}

dependencies {
    compile dependency.scala_lang
    compile dependency.slf4j

    testCompile dependency.scala_test
    testCompile dependency.citrus
    testCompile dependency.junit
    testRuntime dependency.junitRuntime
}

task startDockerContainers() {
    dependsOn = [
        ':keyscore-frontier:startDockerContainer',
        'elasticsearch:startContainer'
    ]
    doLast {
        sleep(10000)
    }
}

task stopDockerContainers() {
    dependsOn = [
        ':keyscore-frontier:removeDockerContainer',
        'elasticsearch:startContainer'
    ]
}

junitPlatformTest {
    dependsOn startDockerContainers
    finalizedBy stopDockerContainers
    outputs.upToDateWhen { false }
}

afterEvaluate {
    def junitPlatformTestTask = tasks.getByName('junitPlatformTest')
    junitPlatformTestTask.systemProperty 'citrus.html.report.directory', "$buildDir/test-results/citrus-reports"
}

