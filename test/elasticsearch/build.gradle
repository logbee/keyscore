import com.bmuschko.gradle.docker.tasks.container.DockerCreateContainer
import com.bmuschko.gradle.docker.tasks.container.DockerRemoveContainer
import com.bmuschko.gradle.docker.tasks.container.DockerStartContainer
import com.bmuschko.gradle.docker.tasks.container.DockerStopContainer
import com.bmuschko.gradle.docker.tasks.image.DockerPullImage


task pullImage(type: DockerPullImage) {
    repository = 'docker.elastic.co/elasticsearch/elasticsearch-oss'
    tag = '6.2.4'
}

task createContainer(type: DockerCreateContainer) {
    dependsOn pullImage
    containerName = 'elasticsearch'
    targetImageId { pullImage.getImageId() }
    env = ['discovery.type=single-node', 'ES_JAVA_OPTS=-Xms512m -Xmx512m']
    portBindings = ['9200:9200', '9300:9300']
    hostName = 'elasticsearch'
    network = project.findProperty('containerNetwork') ?: 'host'
}

task startContainer(type: DockerStartContainer) {
    dependsOn = ['createContainer','::setupDockerNetwork']
    targetContainerId { createContainer.containerName }
}

task stopContainer(type: DockerStopContainer) {
    targetContainerId { createContainer.containerName }
}

task removeContainer(type: DockerRemoveContainer) {
    dependsOn stopContainer
    targetContainerId { createContainer.containerName }
}
